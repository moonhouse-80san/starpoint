<load target="rating.css" />
<load target="../rating.js" />

{@
	$my_s = 'N';
	//평점 모듈
	$oStarPointModel = getModel('starpoint');
	//평점을 평가 했는지 여부를 체크하고, 게시글의 전체 평균 점수를 제공합니다.
	$my_starpoint = $oStarPointModel->getIsRated($oDocument->document_srl);
	$total_point = $oStarPointModel->getDocumentRatedTotalPoint($oDocument->document_srl);
	if($my_starpoint) $my_s = 'Y';
	if(!$mi->starpoint_text) $mi->starpoint_text = '글';
}

<div class="rating-container">
	<div class="rating-widget">
		<div>
			<span class="rating-title">이 {$mi->starpoint_text}의 평점 (참여 : {$total_point->count_members} / 총 점수 : {$total_point->sum})</span>
			
			<span class="rating-average">
				<span class="labels">평균 평점 :</span>
				<span class="stars">
					<!--@for($i=1;$i<=5;$i++)-->
						<span class="star {$total_point->avg >= $i ? 'filled' : ($total_point->avg >= $i-0.5 ? 'half-filled' : 'empty')}">★</span>
					<!--@end-->
					<span class="score">{number_format($total_point->avg, 1)}점</span>
				</span>
			</span>
			
			<!--@if($is_logged && $my_s != 'Y')-->
				<!--@if(abs($oDocument->get('member_srl'))!==$logged_info->member_srl || $grant->is_admin)-->
					<span class="my-rating">
						<span class="labels">내 평점 :</span>
						<span class="stars" id="star-selector">
							<!--@for($i=1;$i<=5;$i++)-->
							<span class="star star-select" data-value="{$i}">★</span>
							<!--@end-->
						</span>
						<span class="selected-rating">
							<span id="selected-value">0</span>점
						</span>
					</span>
					<span class="submit-button">
						<button type="button" class="spb" id="submit-rating" data-document-srl="{$oDocument->document_srl}">평가하기</button>
					</span>
				<!--@else-->
					<div class="login-required">본인의 글은 평가할 수 없습니다.</div>
				<!--@end-->
			<!--@elseif($is_logged && $my_s == 'Y')-->
				<span class="my-rating-display">
					<span class="labels">내가 평가한 점수 :</span>
					<span class="stars">
						<!--@if(is_object($my_starpoint) && isset($my_starpoint->star_rate))-->
							<!--@for($i=1;$i<=5;$i++)-->
							<span class="star {$my_starpoint->star_rate >= $i ? 'filled' : 'empty'}">★</span>
							<!--@end-->
							<span class="score">{$my_starpoint->star_rate}점</span>
						<!--@else-->
							<span class="score">평점 정보를 찾을 수 없습니다.</span>
						<!--@end-->
					</span>
				</span>
				<span class="submit-button">
					<button type="button" class="spb cancel-btn" id="cancel-rating" data-document-srl="{$oDocument->document_srl}">평가 취소</button>
				</span>
			<!--@elseif(!$is_logged)-->
				<div class="login-required">로그인 후 평가하실 수 있습니다.</div>
			<!--@end-->
		</div>
	</div>
</div>